# ğŸŒ± Terra Data Collector

> TerraNeuron SmartFarm Platformì„ ìœ„í•œ **ì™¸ë¶€ ê³µê°œ ë°ì´í„° ìˆ˜ì§‘ ì„œë¹„ìŠ¤**

IoT ì„¼ì„œ ì—†ì´ë„ ì‹¤ì œ ë†ì—… í™˜ê²½ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ íŒŒì´í”„ë¼ì¸ì„ í…ŒìŠ¤íŠ¸í•˜ê³ , On-device AI ëª¨ë¸ í•™ìŠµì— í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ¯ í•µì‹¬ ëª©ì 

| ëª©ì  | ì„¤ëª… |
|------|------|
| **íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸** | ì‹¤ì œ IoT ì—†ì´ ì „ì²´ ë°ì´í„° íë¦„ ê²€ì¦ (ì™¸ë¶€ ë°ì´í„° â†’ terra-sense â†’ Kafka â†’ terra-cortex â†’ terra-ops) |
| **AI í•™ìŠµ ë°ì´í„°** | CSV/JSONL/Parquet í˜•ì‹ìœ¼ë¡œ ëŒ€ëŸ‰ ë°ì´í„° ë‚´ë³´ë‚´ê¸° â†’ On-device AI íŒŒì¸íŠœë‹ì— ì§ì ‘ í™œìš© |
| **ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥** | CLIë¡œ ë‹¨ë… ì‹¤í–‰í•˜ì—¬ ë°ì´í„°ë§Œ ìˆ˜ì§‘/ë‚´ë³´ë‚´ê¸° ê°€ëŠ¥ |
| **IoTì™€ ê³µì¡´** | `source: "external"` íƒœê¹…ìœ¼ë¡œ IoT ë°ì´í„°ì™€ ëª…í™•íˆ êµ¬ë¶„ |

---

## ğŸ“Š ë°ì´í„° ì†ŒìŠ¤

### ğŸŒ¤ï¸ Open-Meteo (ì£¼ë ¥)
- **ë¹„ìš©**: ì™„ì „ ë¬´ë£Œ, API í‚¤ ë¶ˆí•„ìš”
- **í’ˆì§ˆ**: HIGH (ECMWF ê¸°ë°˜ ê¸°ìƒ ë°ì´í„°)
- **ì œê³µ ë°ì´í„°**: ì˜¨ë„, ìŠµë„, í† ì–‘ìˆ˜ë¶„, ì¼ì‚¬ëŸ‰
- **ê³¼ê±° ë°ì´í„°**: ìˆ˜ì‹­ ë…„ ë‹¨ìœ„ ê°€ëŠ¥ â†’ AI í•™ìŠµì— ìµœì 

### ğŸ›°ï¸ NASA POWER
- **ë¹„ìš©**: ì™„ì „ ë¬´ë£Œ, API í‚¤ ë¶ˆí•„ìš”
- **í’ˆì§ˆ**: HIGH (ìœ„ì„± ê´€ì¸¡ ê¸°ë°˜ ë†ì—… íŠ¹í™”)
- **ì œê³µ ë°ì´í„°**: ê¸°ì˜¨, ìŠµë„, ì¼ì‚¬ëŸ‰, ê°•ìˆ˜ëŸ‰
- **ê³¼ê±° ë°ì´í„°**: 30ë…„+ â†’ ì¥ê¸° ê¸°í›„ íŒ¨í„´ í•™ìŠµ

### ğŸ“¡ ThingSpeak
- **ë¹„ìš©**: ë¬´ë£Œ (ê³µê°œ ì±„ë„)
- **í’ˆì§ˆ**: MEDIUM (ì‹¤ì œ IoT ì„¼ì„œ, ë…¸ì´ì¦ˆ í¬í•¨)
- **ì œê³µ ë°ì´í„°**: ì˜¨ì‹¤ ì˜¨ìŠµë„, ê¸°ìƒ ê´€ì¸¡ ë“±
- **íŠ¹ì§•**: ì‹¤ì œ IoT ì„¼ì„œì˜ í˜„ì‹¤ì  ë°ì´í„° íŒ¨í„´

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. ë…ë¦½ ì‹¤í–‰ (CLI)

```bash
cd services/terra-data-collector

# ê°€ìƒí™˜ê²½ & ì˜ì¡´ì„± ì„¤ì¹˜
python -m venv venv
venv\Scripts\activate      # Windows
pip install -r requirements.txt

# ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘ â†’ CSV ë‚´ë³´ë‚´ê¸°
python -m src.cli collect --provider open_meteo --exporter csv_export

# ê³¼ê±° 1ë…„ ë°ì´í„° â†’ AI í•™ìŠµ ë°ì´í„°ì…‹
python -m src.cli collect --provider open_meteo --historical --exporter csv_export --exporter jsonl_export

# ì‹¤ì‹œê°„ ìˆ˜ì§‘ â†’ terra-senseë¡œ ì „ì†¡ (íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸)
python -m src.cli collect --provider open_meteo --exporter terra_bridge

# ì „ì²´ Provider & Exporter ì‚¬ìš©
python -m src.cli collect --all

# ìƒíƒœ í™•ì¸
python -m src.cli status
python -m src.cli providers
python -m src.cli exporters
```

### 2. Docker ì‹¤í–‰ (í”Œë«í¼ í†µí•©)

```bash
# terra-data-collectorë§Œ ì‹¤í–‰
docker compose --profile data-collector up terra-data-collector

# ì „ì²´ í”Œë«í¼ + data-collector
docker compose --profile data-collector up

# APIë¡œ ìˆ˜ì§‘ íŠ¸ë¦¬ê±°
curl -X POST http://localhost:8083/collect/realtime
curl -X POST "http://localhost:8083/collect/historical?start_date=2024-01-01&end_date=2025-01-01"
```

### 3. FastAPI ì„œë²„ ì‹¤í–‰

```bash
cd services/terra-data-collector
python -m src.main
# â†’ http://localhost:8083/docs ì—ì„œ Swagger UI
```

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
terra-data-collector/
â”œâ”€â”€ config.yaml               # ë°ì´í„° ì†ŒìŠ¤ & ë‚´ë³´ë‚´ê¸° ì„¤ì •
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py               # FastAPI ì„œë²„ + ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â”œâ”€â”€ cli.py                # ë…ë¦½ ì‹¤í–‰ CLI
â”‚   â”œâ”€â”€ config.py             # ì„¤ì • ê´€ë¦¬
â”‚   â”œâ”€â”€ models.py             # ë°ì´í„° ëª¨ë¸ (terra-sense í˜¸í™˜)
â”‚   â”œâ”€â”€ collector.py          # ìˆ˜ì§‘ ì—”ì§„ ì½”ì–´
â”‚   â”œâ”€â”€ scheduler.py          # ì£¼ê¸°ì  ìˆ˜ì§‘ ìŠ¤ì¼€ì¤„ëŸ¬
â”‚   â”œâ”€â”€ providers/            # ë°ì´í„° ì†ŒìŠ¤ ì œê³µì (Pluggable)
â”‚   â”‚   â”œâ”€â”€ __init__.py       # BaseProvider ì¶”ìƒ í´ë˜ìŠ¤
â”‚   â”‚   â”œâ”€â”€ open_meteo.py     # Open-Meteo ê¸°ìƒ API
â”‚   â”‚   â”œâ”€â”€ nasa_power.py     # NASA POWER ë†ì—… ë°ì´í„°
â”‚   â”‚   â””â”€â”€ thingspeak.py     # ThingSpeak IoT ì±„ë„
â”‚   â””â”€â”€ exporters/            # ë°ì´í„° ì¶œë ¥ í•¸ë“¤ëŸ¬
â”‚       â”œâ”€â”€ __init__.py       # BaseExporter ì¶”ìƒ í´ë˜ìŠ¤
â”‚       â”œâ”€â”€ terra_bridge.py   # terra-sense HTTP API ì „ì†¡
â”‚       â”œâ”€â”€ kafka_bridge.py   # Kafka ì§ì ‘ ì „ì†¡
â”‚       â”œâ”€â”€ csv_exporter.py   # CSV ë‚´ë³´ë‚´ê¸° (ML)
â”‚       â”œâ”€â”€ jsonl_exporter.py # JSONL ë‚´ë³´ë‚´ê¸° (LLM íŒŒì¸íŠœë‹)
â”‚       â””â”€â”€ parquet_exporter.py # Parquet ë‚´ë³´ë‚´ê¸° (ëŒ€ê·œëª¨ ML)
â””â”€â”€ data/
    â””â”€â”€ exports/              # ë‚´ë³´ë‚´ê¸° ë””ë ‰í† ë¦¬
        â”œâ”€â”€ csv/
        â”œâ”€â”€ jsonl/
        â””â”€â”€ parquet/
```

---

## ğŸ”„ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Terra Data Collector                â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚Open-Meteoâ”‚  â”‚NASA POWERâ”‚  â”‚ThingSpeakâ”‚      â”‚
â”‚  â”‚  (FREE)  â”‚  â”‚  (FREE)  â”‚  â”‚  (FREE)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚              â”‚              â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚              â–¼              â”‚                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚                    â”‚
â”‚     â”‚   Collector    â”‚     â”‚                    â”‚
â”‚     â”‚  (ì •ê·œí™” ì—”ì§„)  â”‚     â”‚                    â”‚
â”‚     â”‚ source:externalâ”‚     â”‚                    â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                    â”‚
â”‚             â”‚              â”‚                    â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                    â”‚
â”‚     â”‚                    â”‚ â”‚                    â”‚
â”‚     â–¼                    â–¼ â–¼                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚Terra â”‚  â”‚Kafka â”‚  â”‚ CSV  â”‚  â”‚JSONL â”‚       â”‚
â”‚  â”‚Bridgeâ”‚  â”‚Bridgeâ”‚  â”‚Exportâ”‚  â”‚Exportâ”‚       â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”¬â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚         â”‚         â”‚         â”‚
      â–¼         â–¼         â”‚         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”    â”‚         â”‚
â”‚terra-senseâ”‚ â”‚Kafka â”‚    â–¼         â–¼
â”‚ HTTP API  â”‚ â”‚Topic â”‚  ğŸ’¾ AI     ğŸ’¾ LLM
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜  í•™ìŠµìš©    íŒŒì¸íŠœë‹
      â”‚          â”‚
      â–¼          â–¼
   ê¸°ì¡´ TerraNeuron íŒŒì´í”„ë¼ì¸
   (terra-cortex â†’ terra-ops)
```

---

## ğŸ“¤ ë‚´ë³´ë‚´ê¸° í˜•ì‹

### CSV (ML í•™ìŠµ)
ì¼ë³„/ì£¼ë³„/ì›”ë³„ ë¶„í• , ì „ì²´ ë©”íƒ€ë°ì´í„° í¬í•¨
```csv
sensorId,sensorType,value,unit,farmId,timestamp,source,provider,quality
openmeteo-temperature-farm-A,temperature,24.5,Â°C,farm-A,2024-06-15T10:00:00.000Z,external,open_meteo,high
```

### JSONL â€” Instruction Format (LLM íŒŒì¸íŠœë‹)
Alpaca / ShareGPT í˜•ì‹ í˜¸í™˜
```json
{"instruction": "ë‹¤ìŒì€ ìŠ¤ë§ˆíŠ¸íŒœ ì„¼ì„œ ë°ì´í„°ì…ë‹ˆë‹¤. ë¶„ì„í•˜ì„¸ìš”:\në†ì¥: farm-A, ì„¼ì„œ: temperature, ê°’: 36.5Â°C", "input": "temperature=36.5Â°C", "output": "[ìœ„í—˜] temperature 36.5Â°Cë¡œ ì„ê³„ì¹˜(35Â°C) ì´ˆê³¼. ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”. í™˜ê¸° ë° ëƒ‰ê° ì‹œìŠ¤í…œ ê°€ë™ ê¶Œì¥."}
```

### Parquet (ëŒ€ê·œëª¨ ML)
ì„¼ì„œ íƒ€ì…ë³„ ë¶„í• , snappy ì••ì¶•, pandas/spark í˜¸í™˜

---

## âš™ï¸ ì„¤ì • (`config.yaml`)

| ì„¹ì…˜ | ì„¤ëª… |
|------|------|
| `farms` | ìœ„ì¹˜(ìœ„ë„/ê²½ë„) ê¸°ë°˜ ë†ì¥ ë§¤í•‘ |
| `providers` | ë°ì´í„° ì†ŒìŠ¤ í™œì„±í™”/ë¹„í™œì„±í™”, ìˆ˜ì§‘ ë³€ìˆ˜, ê³¼ê±° ë°ì´í„° ë²”ìœ„ |
| `exporters` | ì¶œë ¥ ëŒ€ìƒ ì„¤ì • (terra-sense URL, Kafka, íŒŒì¼ ê²½ë¡œ) |
| `tagging` | `source: "external"` ë¡œ IoT ë°ì´í„°ì™€ êµ¬ë¶„ |
| `scheduler` | cron ê¸°ë°˜ ìë™ ìˆ˜ì§‘ ìŠ¤ì¼€ì¤„ |

---

## ğŸ”— IoT ë°ì´í„°ì™€ì˜ ê´€ê³„

```
IoT ì„¼ì„œ â†’ terra-sense (source: iot)      â† ì‹¤ì œ ì¥ì¹˜
Data Collector â†’ terra-sense (source: external) â† ì™¸ë¶€ ë°ì´í„°

            ë™ì¼í•œ íŒŒì´í”„ë¼ì¸ì„ íƒ€ì§€ë§Œ source íƒœê¹…ìœ¼ë¡œ êµ¬ë¶„
```

- IoT ì¥ì¹˜ê°€ ì—°ê²°ë˜ë©´ **ë‘ ì†ŒìŠ¤ê°€ ê³µì¡´** ê°€ëŠ¥
- ëŒ€ì‹œë³´ë“œì—ì„œ `source` í•„ë“œë¡œ í•„í„°ë§ ê°€ëŠ¥
- Data Collectorë¥¼ ë„ë”ë¼ë„ IoT íŒŒì´í”„ë¼ì¸ì— ì˜í–¥ ì—†ìŒ

---

## ğŸ§  On-device AI í•™ìŠµ í™œìš©

1. **ê³¼ê±° ë°ì´í„° ìˆ˜ì§‘** â†’ CSV/Parquetë¡œ ë‚´ë³´ë‚´ê¸°
2. **JSONL íŒŒì¸íŠœë‹ ë°ì´í„°** â†’ ì„¼ì„œ ë¶„ì„ Instruction ìë™ ìƒì„±
3. **ë°ì´í„° í’ˆì§ˆ íƒœê¹…** â†’ í•™ìŠµ ì‹œ ë°ì´í„° ê°€ì¤‘ì¹˜ ì„¤ì •ì— í™œìš©
4. **ì¥ê¸° íŒ¨í„´ ë°ì´í„°** â†’ NASA POWER 30ë…„+ ê¸°í›„ ë°ì´í„°ë¡œ ê³„ì ˆì„± í•™ìŠµ

---

## ğŸ“¡ API ì—”ë“œí¬ì¸íŠ¸

| Method | Path | Description |
|--------|------|-------------|
| GET | `/` | ì„œë¹„ìŠ¤ ì •ë³´ |
| GET | `/health` | í—¬ìŠ¤ì²´í¬ |
| POST | `/collect/realtime` | ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘ |
| POST | `/collect/historical` | ê³¼ê±° ë°ì´í„° ìˆ˜ì§‘ |
| GET | `/stats` | ìˆ˜ì§‘ í†µê³„ |
| GET | `/providers` | Provider ëª©ë¡ |
| GET | `/exporters` | Exporter ëª©ë¡ |
